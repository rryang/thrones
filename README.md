# thrones

## 一. 系统整体架构

### （一）系统架构图

![image](./asset/system_structure.jpg)

### （二）系统设计规范
#### 1. 客户端通过webSocket与服务器端（api层）建立长连接，实现双向通信。
#### 2. api层不包含业务逻辑。其主要功能约定如下：
* 维护webSocket连接。
* 维护消息队列topic与用户连接的映射关系。
* 用户请求和消息的解析、校验、转发。
#### 3. api层与service层交互过程：
* 下行数据使用gRPC，接口实时返回处理状态。
* 上行数据通过rabbitMQ的消息机制通过api层通知给所有订阅该topic的所有用户，实现处理结果的广播。
#### 4. *持久化层： 
* 由于游戏场景的特殊性，实时的对局状态存储在redis中。
* 注册用户信息，历史聊天记录等存储在MySQL中。


